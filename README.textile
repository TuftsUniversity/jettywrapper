h1. jettywrapper

This gem is designed to make it easier to run automated tests against jetty. Solr comes bundled in a jetty instance, and the hydra project has taken a similar approach with hydra-jetty, an instance of jetty pre-configured to load fedora, solr, and various other java servlets of use to the hydra project. 

h2. Instructions for the impatient:

bc.. 
  require 'jettywrapper'
  desc "Hudson build"
  task :hudson do
    if (ENV['RAILS_ENV'] == "test")
      jetty_params = { 
        :jetty_home => File.expand_path(File.dirname(__FILE__) + '/../../jetty'), 
        :quiet => false, 
        :jetty_port => 8983, 
        :solr_home => File.expand_path(File.dirname(__FILE__) + '/../../jetty/solr'),
        :fedora_home => File.expand_path(File.dirname(__FILE__) + '/../../jetty/fedora/default'),
        :startup_wait => 30
        }
      Rake::Task["db:drop"].invoke
      Rake::Task["db:migrate"].invoke
      Rake::Task["db:migrate:plugins"].invoke
      error = Jettywrapper.wrap(jetty_params) do  
        Rake::Task["libra_oa:default_fixtures:refresh"].invoke
        Rake::Task["hydra:fixtures:refresh"].invoke
        Rake::Task["spec"].invoke
        Rake::Task["cucumber"].invoke
      end
      raise "test failures: #{error}" if error
    else
      system("rake hudson RAILS_ENV=test")
    end
  end
